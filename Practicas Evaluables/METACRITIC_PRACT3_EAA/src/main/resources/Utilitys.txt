package org.example;

import org.w3c.dom.*;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.*;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;

public class Utilitys {
    public void escribirXML(ArrayList<Musico> listaMusicos) {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        Document documento = null;
        try {
            DocumentBuilder builder = factory.newDocumentBuilder();

            DOMImplementation dom = builder.getDOMImplementation();

            documento = dom.createDocument(null,  "Musicos", null);

            Element raiz = documento.getDocumentElement();
            Element nodoMusico = null, nodoNombre = null, nodoAnyo = null, nodoGenero = null, nodoFrontman = null;
            Text texto = null;

            for (Musico Musico : listaMusicos) {
                nodoMusico = documento.createElement("Musico");
                raiz.appendChild(nodoMusico);

                /// MODIFICACIÓN: AÑADIR ATRIBUTOS "DISCOGRAFICA" Y "PAIS DE ORIGEN" -- Apartado 2
                nodoMusico.setAttribute("discografica",Musico.getDiscografica());
                nodoMusico.setAttribute("pais_de_origen",Musico.getPaisOrigen());

                nodoNombre = documento.createElement("nombre");
                nodoMusico.appendChild(nodoNombre);

                texto = documento.createTextNode(Musico.getNombre());
                nodoNombre.appendChild(texto);

                nodoAnyo = documento.createElement("anyo_formacion");
                nodoMusico.appendChild(nodoAnyo);

                texto = documento.createTextNode(String.valueOf(Musico.getFormacion()));
                nodoAnyo.appendChild(texto);

                nodoGenero = documento.createElement("genero");
                nodoMusico.appendChild(nodoGenero);

                texto = documento.createTextNode(Musico.getGenero());
                nodoGenero.appendChild(texto);

                /// MODIFICACIÓN: AÑADIR NODO "FRONTMAN" -- Apartado 1
                nodoFrontman = documento.createElement("frontman");
                nodoMusico.appendChild(nodoFrontman);

                texto = documento.createTextNode(Musico.getFrontman());
                nodoFrontman.appendChild(texto);
            }

            Source source = new DOMSource(documento);
            Result resultado = new StreamResult(new File("GruposMusica.xml"));

            Transformer transformer = TransformerFactory.newInstance().newTransformer();
            transformer.transform(source, resultado);

        } catch (ParserConfigurationException | TransformerException pce) {
            pce.printStackTrace();
        }
    }

    public void leerFicheroXML() {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        Document documento = null;

        try {
            DocumentBuilder builder = factory.newDocumentBuilder();

            documento = builder.parse(new File("GruposMusica.xml"));

            NodeList Musicos = documento.getElementsByTagName("Musico");
            for (int i = 0; i < Musicos.getLength(); i++) {
                Node Musico = Musicos.item(i);

                if(Musico.getNodeType() == Node.ELEMENT_NODE) {
                    Element elemento = (Element) Musico;


                    System.out.print(elemento.getElementsByTagName("nombre").item(0).getTextContent());
                    System.out.print(" // ");
                    System.out.print(elemento.getElementsByTagName("anyo_formacion").item(0).getTextContent());
                    System.out.print(" // ");
                    System.out.print(elemento.getElementsByTagName("genero").item(0).getTextContent());
                    System.out.print(" // ");
                    /// MODIFICACIÓN: AÑADIR NODO "FRONTMAN" -- Apartado 1
                    System.out.print(elemento.getElementsByTagName("frontman").item(0).getTextContent());
                    System.out.print(" // ");

                    /// MODIFICACIÓN: AÑADIR ATRIBUTOS "DISCOGRAFIA" Y "PAIS DE ORIGEN" -- Apartado 2
                    System.out.print(elemento.getAttribute("discografica"));
                    System.out.print(" // ");
                    System.out.print(elemento.getAttribute("pais_de_origen"));
                    System.out.println();
                }
            }
        } catch (ParserConfigurationException | IOException | SAXException pce) {
            pce.printStackTrace();
        }
    }
}